{{ define "email.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .header { background-color: {{ if eq .CommonLabels.severity "critical" }}#dc3545{{ else if eq .CommonLabels.severity "warning" }}#ffc107{{ else }}#28a745{{ end }}; color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; }
        .alert-box { background-color: #f8f9fa; border-left: 4px solid {{ if eq .CommonLabels.severity "critical" }}#dc3545{{ else if eq .CommonLabels.severity "warning" }}#ffc107{{ else }}#28a745{{ end }}; padding: 15px; margin: 10px 0; }
        .alert-details { background-color: #fff; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; }
        .label { font-weight: bold; color: #495057; }
        .value { color: #212529; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #dee2e6; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .footer { background-color: #f8f9fa; padding: 15px; text-align: center; font-size: 12px; color: #6c757d; margin-top: 20px; }
        .firing { color: #dc3545; font-weight: bold; }
        .resolved { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üö® Trading System Alert</h1>
        <h2>{{ .GroupLabels.alertname }}</h2>
    </div>

    <div class="content">
        <div class="alert-box">
            <p class="label">Status:</p>
            <p class="{{ if gt (len .Alerts.Firing) 0 }}firing{{ else }}resolved{{ end }}">
                {{ if gt (len .Alerts.Firing) 0 }}
                    üî¥ FIRING ({{ len .Alerts.Firing }} alerts)
                {{ else }}
                    ‚úÖ RESOLVED
                {{ end }}
            </p>
        </div>

        <div class="alert-details">
            <h3>Summary</h3>
            <p>{{ .CommonAnnotations.summary }}</p>

            <h3>Description</h3>
            <p>{{ .CommonAnnotations.description }}</p>

            <h3>Details</h3>
            <table>
                <tr>
                    <th>Property</th>
                    <th>Value</th>
                </tr>
                <tr>
                    <td class="label">Severity</td>
                    <td class="value">{{ .CommonLabels.severity | toUpper }}</td>
                </tr>
                {{ if .CommonLabels.component }}
                <tr>
                    <td class="label">Component</td>
                    <td class="value">{{ .CommonLabels.component }}</td>
                </tr>
                {{ end }}
                {{ if .CommonLabels.cluster }}
                <tr>
                    <td class="label">Cluster</td>
                    <td class="value">{{ .CommonLabels.cluster }}</td>
                </tr>
                {{ end }}
                <tr>
                    <td class="label">Firing Since</td>
                    <td class="value">{{ (index .Alerts 0).StartsAt }}</td>
                </tr>
                {{ if gt (len .Alerts.Resolved) 0 }}
                <tr>
                    <td class="label">Resolved At</td>
                    <td class="value">{{ (index .Alerts.Resolved 0).EndsAt }}</td>
                </tr>
                {{ end }}
            </table>
        </div>

        {{ if gt (len .Alerts.Firing) 0 }}
        <div class="alert-details">
            <h3>Firing Alerts ({{ len .Alerts.Firing }})</h3>
            <table>
                <tr>
                    <th>Alert</th>
                    <th>Instance</th>
                    <th>Started At</th>
                </tr>
                {{ range .Alerts.Firing }}
                <tr>
                    <td>{{ .Labels.alertname }}</td>
                    <td>{{ .Labels.instance }}</td>
                    <td>{{ .StartsAt }}</td>
                </tr>
                {{ end }}
            </table>
        </div>
        {{ end }}

        {{ if gt (len .Alerts.Resolved) 0 }}
        <div class="alert-details">
            <h3>Resolved Alerts ({{ len .Alerts.Resolved }})</h3>
            <table>
                <tr>
                    <th>Alert</th>
                    <th>Instance</th>
                    <th>Duration</th>
                </tr>
                {{ range .Alerts.Resolved }}
                <tr>
                    <td>{{ .Labels.alertname }}</td>
                    <td>{{ .Labels.instance }}</td>
                    <td>{{ .StartsAt }} - {{ .EndsAt }}</td>
                </tr>
                {{ end }}
            </table>
        </div>
        {{ end }}
    </div>

    <div class="footer">
        <p>Trading System AlertManager | Generated at {{ now }}</p>
        <p>For more information, check the <a href="http://prometheus.example.com">Prometheus</a> or <a href="http://grafana.example.com">Grafana</a> dashboards.</p>
    </div>
</body>
</html>
{{ end }}

{{ define "email.security.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .header { background-color: #dc3545; color: white; padding: 20px; text-align: center; border: 3px solid #a71d2a; }
        .security-warning { background-color: #fff3cd; border-left: 5px solid #ffc107; padding: 20px; margin: 20px; }
        .content { padding: 20px; }
        .critical-info { background-color: #f8d7da; border: 2px solid #f5c6cb; padding: 15px; margin: 10px 0; }
        .label { font-weight: bold; color: #721c24; }
        .actions { background-color: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üö® SECURITY ALERT üö®</h1>
        <h2>{{ .GroupLabels.alertname }}</h2>
    </div>

    <div class="security-warning">
        <strong>‚ö†Ô∏è This is a security-related alert that requires immediate attention.</strong>
    </div>

    <div class="content">
        <div class="critical-info">
            <p class="label">Summary:</p>
            <p>{{ .CommonAnnotations.summary }}</p>

            <p class="label">Description:</p>
            <p>{{ .CommonAnnotations.description }}</p>

            <p class="label">Severity:</p>
            <p>{{ .CommonLabels.severity | toUpper }}</p>

            <p class="label">Time:</p>
            <p>{{ (index .Alerts 0).StartsAt }}</p>
        </div>

        <div class="actions">
            <h3>Recommended Actions:</h3>
            <ul>
                <li>Review application logs immediately</li>
                <li>Check for unauthorized access attempts</li>
                <li>Verify system integrity</li>
                <li>Alert security team if not already notified</li>
                <li>Document incident for security audit</li>
            </ul>
        </div>
    </div>
</body>
</html>
{{ end }}

{{ define "pagerduty.details.firing" }}
{{ range .Alerts.Firing }}
- Alert: {{ .Labels.alertname }}
  Instance: {{ .Labels.instance }}
  Started: {{ .StartsAt }}
  Summary: {{ .Annotations.summary }}
{{ end }}
{{ end }}

{{ define "pagerduty.details.resolved" }}
{{ range .Alerts.Resolved }}
- Alert: {{ .Labels.alertname }}
  Instance: {{ .Labels.instance }}
  Duration: {{ .StartsAt }} to {{ .EndsAt }}
{{ end }}
{{ end }}

{{ define "slack.title" }}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.alertname }}
{{ end }}

{{ define "slack.text" }}
{{ if gt (len .Alerts.Firing) 0 }}
*Firing Alerts:*
{{ range .Alerts.Firing }}
‚Ä¢ {{ .Annotations.summary }}
  _Instance:_ {{ .Labels.instance }}
  _Started:_ {{ .StartsAt }}
{{ end }}
{{ end }}
{{ if gt (len .Alerts.Resolved) 0 }}
*Resolved Alerts:*
{{ range .Alerts.Resolved }}
‚Ä¢ {{ .Annotations.summary }}
  _Duration:_ {{ .StartsAt }} to {{ .EndsAt }}
{{ end }}
{{ end }}
{{ end }}
