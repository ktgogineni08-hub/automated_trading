# Kubernetes Secrets Template for Trading System
# Phase 3 Tier 3: DevOps & Cloud Infrastructure
#
# IMPORTANT: This is a template file. Do NOT commit actual secrets to git!
# Use tools like sealed-secrets, external-secrets, or Vault in production.
#
# To create secrets from this template:
# 1. Copy this file to secrets.yml
# 2. Replace <BASE64_ENCODED_VALUE> with actual base64-encoded values
# 3. Apply: kubectl apply -f secrets.yml
# 4. Delete secrets.yml immediately (don't commit!)

apiVersion: v1
kind: Secret
metadata:
  name: trading-secrets
  namespace: trading
  labels:
    app: trading-system
type: Opaque
data:
  # Base64 encode your values:
  # echo -n "your-api-key" | base64

  # Zerodha API credentials
  api-key: <BASE64_ENCODED_API_KEY>
  access-token: <BASE64_ENCODED_ACCESS_TOKEN>

  # Encryption key (32 bytes, base64 encoded)
  encryption-key: <BASE64_ENCODED_ENCRYPTION_KEY>

  # Database credentials (if using external DB)
  db-username: <BASE64_ENCODED_DB_USERNAME>
  db-password: <BASE64_ENCODED_DB_PASSWORD>

---
apiVersion: v1
kind: Secret
metadata:
  name: redis-secret
  namespace: trading
  labels:
    app: trading-system
type: Opaque
data:
  # Redis password
  password: <BASE64_ENCODED_REDIS_PASSWORD>

---
# Example of using external-secrets (recommended for production)
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: trading-secrets
#   namespace: trading
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secretsmanager
#     kind: SecretStore
#   target:
#     name: trading-secrets
#     creationPolicy: Owner
#   data:
#   - secretKey: api-key
#     remoteRef:
#       key: prod/trading-system/zerodha
#       property: api_key
#   - secretKey: access-token
#     remoteRef:
#       key: prod/trading-system/zerodha
#       property: access_token
#   - secretKey: encryption-key
#     remoteRef:
#       key: prod/trading-system/encryption
#       property: key

---
# ServiceAccount for Trading System
apiVersion: v1
kind: ServiceAccount
metadata:
  name: trading-system
  namespace: trading
  labels:
    app: trading-system

---
# Role for Trading System (minimal permissions)
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: trading-system-role
  namespace: trading
rules:
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "list"]
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get"]

---
# RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: trading-system-rolebinding
  namespace: trading
subjects:
- kind: ServiceAccount
  name: trading-system
  namespace: trading
roleRef:
  kind: Role
  name: trading-system-role
  apiGroup: rbac.authorization.k8s.io
