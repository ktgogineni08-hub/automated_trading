# Trading System Configuration - Single Source of Truth
# Version: 1.0
# Last Updated: 2025-11-04

# =============================================================================
# API Configuration
# =============================================================================
api:
  zerodha:
    # Loaded from environment variables (never commit secrets!)
    api_key: ${ZERODHA_API_KEY}
    api_secret: ${ZERODHA_API_SECRET}
    token_file: ~/.config/trading-system/zerodha_token.json
    request_delay: 0.25  # seconds between requests

# =============================================================================
# Trading Configuration
# =============================================================================
trading:
  capital:
    initial: 1000000  # â‚¹10L default capital

  # RISK MANAGEMENT - SINGLE SOURCE OF TRUTH
  risk:
    # Core risk parameters
    risk_per_trade_pct: 0.015      # 1.5% per trade (conservative)
    stop_loss_pct: 0.03            # 3% stop loss
    take_profit_pct: 0.10          # 10% take profit
    max_daily_loss_pct: 0.05       # 5% max daily loss
    max_position_loss_pct: 0.10    # 10% max position loss

    # Position limits
    max_trades_per_day: 150
    max_open_positions: 20
    max_trades_per_symbol_per_day: 8
    max_sector_exposure: 6
    max_consecutive_losses: 3

    # Position sizing
    min_position_size_pct: 0.10    # 10% of capital min
    max_position_size_pct: 0.25    # 25% of capital max
    max_positions: 25

    # ATR-based stops
    atr_stop_multiplier: 2.0
    atr_target_multiplier: 3.5
    trailing_activation_multiplier: 1.5
    trailing_stop_multiplier: 0.8

  # Strategy configuration
  strategies:
    min_confidence: 0.65             # Minimum confidence for trades
    aggregator_min_agreement: 0.4    # Strategy agreement threshold
    cooldown_minutes: 10             # Cooldown after regular trades
    stop_loss_cooldown_minutes: 20   # Longer cooldown after stop loss

  # Market hours
  hours:
    start: "09:15"
    end: "15:30"
    timezone: "Asia/Kolkata"

  # Trading modes
  modes:
    paper:
      enabled: true
      bypass_market_hours: false  # Respect market hours by default
    live:
      enabled: true
      bypass_market_hours: false
    backtest:
      enabled: true
      fast_mode: true

# =============================================================================
# F&O Configuration
# =============================================================================
fno:
  indices:
    - NIFTY
    - BANKNIFTY
    - FINNIFTY

  lot_sizes:
    NIFTY: 50
    BANKNIFTY: 15
    FINNIFTY: 40

  fallback_spot_prices:
    NIFTY: 25000
    BANKNIFTY: 53500
    FINNIFTY: 19500

  option_chain:
    limit: 150      # Performance limit
    timeout: 30     # seconds

# =============================================================================
# Dashboard Configuration
# =============================================================================
dashboard:
  host: ${DASHBOARD_HOST:localhost}
  port: ${DASHBOARD_PORT:8080}
  auto_open_browser: true

  ssl:
    enabled: true
    cert_file: certs/dashboard.crt
    key_file: certs/dashboard.key

  api_key: ${DASHBOARD_API_KEY}

# =============================================================================
# Logging Configuration
# =============================================================================
logging:
  level: ${LOG_LEVEL:INFO}
  file: trading_system.log
  max_size_mb: 50
  backup_count: 5
  structured: true

  # ELK Stack integration
  elk:
    enabled: false
    host: ${ELK_HOST:localhost}
    port: ${ELK_PORT:9200}

# =============================================================================
# Database Configuration
# =============================================================================
database:
  postgresql:
    host: ${POSTGRES_HOST:localhost}
    port: ${POSTGRES_PORT:5432}
    database: ${POSTGRES_DB:trading}
    user: ${POSTGRES_USER:trading_user}
    password: ${POSTGRES_PASSWORD}
    pool_size: 10
    max_overflow: 20

  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    db: ${REDIS_DB:0}
    password: ${REDIS_PASSWORD}
    max_connections: 50

# =============================================================================
# Storage Directories
# =============================================================================
directories:
  logs: logs
  state: state
  backtest_results: backtest_results
  trade_archives: trade_archives
  saved_trades: saved_trades

# =============================================================================
# Security Configuration
# =============================================================================
security:
  client_id: CLIENT_001
  require_kyc: true
  enforce_aml: true
  enable_rbac: true

  # Session configuration
  session_timeout_minutes: 60
  max_failed_login_attempts: 5

# =============================================================================
# Market Indexes (for trend analysis)
# =============================================================================
market_indexes:
  NIFTY: 256265
  BANKNIFTY: 260105
  FINNIFTY: 9992609
  MIDCPNIFTY: 12318082
  SENSEX: 265

# =============================================================================
# Trading Profiles (for different risk levels)
# =============================================================================
profiles:
  conservative:
    risk_per_trade_pct: 0.010      # 1%
    max_position_size_pct: 0.15    # 15%
    min_confidence: 0.75           # 75%

  moderate:
    risk_per_trade_pct: 0.015      # 1.5%
    max_position_size_pct: 0.20    # 20%
    min_confidence: 0.65           # 65%

  aggressive:
    risk_per_trade_pct: 0.020      # 2%
    max_position_size_pct: 0.30    # 30%
    min_confidence: 0.50           # 50%

# =============================================================================
# Backtesting Configuration
# =============================================================================
backtest:
  fast_mode:
    enabled: true
    min_confidence: 0.65
    top_n: 1
    max_positions: 8

  validation:
    # Ensure backtest matches live trading logic
    use_unified_logic: true
    enforce_cooldowns: true
    enforce_market_hours: false  # Can test 24/7

# =============================================================================
# Alert Configuration
# =============================================================================
alerts:
  enabled: true
  channels:
    email:
      enabled: false
      smtp_host: ${SMTP_HOST}
      smtp_port: ${SMTP_PORT:587}
      from_email: ${ALERT_EMAIL}

    slack:
      enabled: false
      webhook_url: ${SLACK_WEBHOOK_URL}

    pagerduty:
      enabled: false
      api_key: ${PAGERDUTY_API_KEY}

# =============================================================================
# Performance Monitoring
# =============================================================================
monitoring:
  prometheus:
    enabled: false
    port: 9090

  grafana:
    enabled: false
    port: 3000
